<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough" lang="en">
<h:head>
	<meta charset="utf-8" />
	<title><ui:insert name="title">Dynamo</ui:insert></title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="manifest" href="/manifest.json" />
	<ui:include src="/fragment-styles.xhtml" />

	<script src="resources/jquery-1.11.2.min.js" type="text/javascript"/>
</h:head>

<h:body>
	<div id="wrap">

		<h:panelGroup id="navbar">
			<div class="navbar navbar-default navbar-static-top" role="navigation">
				<div class="container">
					<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
						<div class="navbar-header">
							<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>
							<h:link styleClass="navbar-brand" outcome="welcome">Dynamo</h:link>
						</div>
						<div class="collapse navbar-collapse navbar-ex1-collapse">
							<ul class="nav navbar-nav">
							
								<ui:include src="/application-menu.xhtml" />

								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-spinner fa-spin"></i>&nbsp;Activity<span class="caret"></span></a>
									<ul class="dropdown-menu" role="menu">
										<li>
											<h:link outcome="activity-running">
												<i class="fa fa-cog fa-spin"></i>&nbsp;Running Tasks
											</h:link>
										</li>
										<li>
											<h:link outcome="activity-backlog">
												<i class="fa fa-tasks"></i>&nbsp;Tasks Backlog
											</h:link>
										</li>
										<li>
											<h:link	outcome="history">
												<i class="fa fa-list"></i>&nbsp;History
											</h:link>
										</li>
										<li>
											<h:link	outcome="log">
												<i class="fa fa-warning"></i>&nbsp;Events
											</h:link>
										</li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-cogs"></i>&nbsp;Setup<span class="caret"></span></a>
									<ul class="dropdown-menu" role="menu">
										<li><h:link outcome="config-plugins"><i class="fa fa-sliders" />&nbsp;Plugins</h:link></li>
										<li><h:link outcome="configuration"><i class="fa fa-cog" />&nbsp;	Configuration</h:link></li>
									</ul>
								</li>
							</ul>
						</div>
					</nav>
				</div>
			</div>
		</h:panelGroup>

		<div class="container-fluid">
			<div class="row">
				<h:messages id="messages"
					style="list-style-type:none; padding-left: 0px;"
					fatalClass="alert alert-danger" errorClass="alert alert-danger"
					infoClass="alert alert-success" warnClass="alert alert-warning" />
			</div>
			<div class="row">
				<ui:insert name="content">
					<div class="hero-unit">
						<h1>Feature Coming Soon!</h1>
					</div>
				</ui:insert>
			</div>
		</div>
	</div>

	<ui:include src="/fragment-footer.xhtml" />

	<!-- Le javascript
    ================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->

	<script src="resources/bootstrap/js/bootstrap.min.js" type="text/javascript"/>
	<script src="resources/bootstrap3-typeahead.min.js" type="text/javascript"/>
	<script src="resources/pnotify/pnotify.custom.min.js" type="text/javascript"/>
	<script src="resources/jquery.unveil.js" type="text/javascript"/>
	<script src="resources/dynamo.js" type="text/javascript"/>

	<script type="text/javascript">
	
		function removeParent( component, tag ) {
			$(component).closest( tag ).remove();
		}
	
		$('.checkBoxSelectionButton').click( function() {
			$(':checkbox', $(this).closest('.table')).each(
				function(){
					if (this.checked) {
						$(this).prop('checked', false);
					} else {
						$(this).prop('checked', true);
					}
				})
			return false;
		});

		var focusField;
		
		jsf.ajax.addOnError(function(data) {

		    // This shows how to get the information via XPath, but it is not required. The error name can be found using data.errorName
		    var errorName = data.responseXML.evaluate('//error/error-name', data.responseXML, null, XPathResult.STRING_TYPE, null);
		    var message = 'AJAX Exception';
		    message += '\nSource: ' + data.source.id;
		    message += '\nValue:' + data.source.value;
		    message += '\nError: ' + errorName.stringValue;
		    message += '\nMessage: ' + data.errorMessage;
		    
			new PNotify({
				title : errorName.stringValue,
				type : 'error',
				text : data.errorMessage
			});

		});

		jsf.ajax.addOnEvent(function(data) {
			var ajaxstatus = data.status; // Can be "begin", "complete" and "success"
			
			if (!data.source) {
				return;
			}
			
			var source = document.getElementById(data.source.id);
			if (source) {
				var icon = $(source.getElementsByTagName('i')[0]);
			}
			
			if (data.type === "event") {

				switch (ajaxstatus) {
				case "begin": // This is called right before ajax request is been sent.
					if (icon) {
						window.previousClass = icon.attr('class');
						if (icon.parent().hasClass('btn-mini')) {
							icon.attr('class', 'fa fa-refresh');
						} else {
							icon.attr('class', 'fa fa-spin fa-refresh');
						}
					}
					break;

				case "complete": // This is called right after ajax response is received.
					break;

				case "success": // This is called when ajax response is successfully processed.
					var fieldToFocusId = localStorage.getItem('fieldToFocus');
					documentReady();
					if (icon) {
						icon.attr('class', window.previousClass);
					}
					if (!fieldToFocusId) {
						fieldToFocusId = data.source.id;
					}
					var fieldToFocus = document.getElementById(fieldToFocusId);
					if (fieldToFocus) {
						fieldToFocus.focus();
						if (typeof (fieldToFocus.select) == "function") {
							fieldToFocus.select();
						}
					}
					break;
				}

			}
		});

		var ws = null;

		function connect() {
			var target = "ws://#{request.serverName}:#{request.serverPort}/websocket/messages";
			if ('WebSocket' in window) {
				ws = new WebSocket(target);
			} else if ('MozWebSocket' in window) {
				ws = new MozWebSocket(target);
			} else {
				return;
			}
			ws.onopen = function() {

			};
			ws.onmessage = function(event) {
				var eventStruct = JSON.parse(event.data);
				new PNotify({
					title : eventStruct.title,
					type : eventStruct.type,
					text : eventStruct.body
				});
			};
			ws.onclose = function() {

			};
		}

		function disconnect() {
			if (ws != null) {
				ws.close();
				ws = null;
			}
		}

		function documentReady() {
			$('img').unveil();
			$('input, textarea, select').focus(function() {
				localStorage.setItem('fieldToFocus', this.id);
			});
			if (typeof (initPage) == "function") {
				initPage();
			}
		}
		
		function redownload(id) {
			$.ajax({
				  url: "redownload",
				  data: {
				    id: id
				  },
				  beforeSend: function() {
					  disappear( 'bounceOutUp', $('#' + id) );
				  }
			});
		}
		
		function want(id) {
			$.ajax({
				  url: "want",
				  data: {
				    id: id
				  },
				  beforeSend: function() {
					  disappear( 'bounceOutUp', $('#' + id) );
				  }
			});
		}

		function ignore(id) {
			$.ajax({
				  url: "ignore",
				  data: {
				    id: id
				  },
				  beforeSend: function() {
					  disappear( 'bounceOutUp', $('#' + id) );
				  }
			});
		}	
		
		function deleteDownloadable(id) {
			$.ajax({
				  url: "delete",
				  data: {
				    id: id
				  },
				  beforeSend: function() {
					  disappear( 'bounceOutUp', $('#' + id) );
				  }
			});
		}			
		
	</script>

	<ui:insert name="custom_js">
	</ui:insert>

	<script type="text/javascript">
		PNotify.prototype.options.styling = "fontawesome";
	
		$(document).ready(function() {
			documentReady();
			connect();
		});
		$(window).on('beforeunload', function() {
			disconnect();
		});
	</script>

</h:body>
</html>

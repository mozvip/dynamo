<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core">

<ui:composition template="/template.xhtml">

	<ui:define name="content">
	
		<ui:include src="/fragment-filesDialog.xhtml" />

		<style>
			.downloadableThumb {
				border: none;
				height: 350px;
			}
			
			.magazineThumb img {
				height: 320px;
			}
			
			.thumbnail .caption {
				white-space: nowrap;
				text-align: center;
			}

			.buttons {
				position: absolute; right: 32px; top: 10px;
			}
		</style>
		
		<ui:include src="magazines-criteria.xhtml" />
		
		<h:form id="listForm">
			<ui:include src="/components/pager.xhtml" />

			<ui:repeat var="issue" value="#{pager.items}">
				<div id="#{issue.id}" class="magazine col-lg-2 col-md-2 col-sm-3 col-xs-6">
					<div class="thumbnail downloadableThumb">
						<ui:fragment rendered="#{issue.status == 'DOWNLOADED'}">					
							<a href="/download?id=#{issue.id}" target="_blank">
								<img data-src="#{issue.urlEncodedCoverImage}" alt="#{issue.name}" title="#{issue.name}" />
							</a>
						</ui:fragment>
						<ui:fragment rendered="#{issue.status != 'DOWNLOADED'}">					
							<img data-src="#{issue.urlEncodedCoverImage}" alt="#{issue.name}" title="#{issue.name}" />
						</ui:fragment>
						<div class="caption">#{issue.name}</div>
					</div>
					<div class="buttons">
						<ui:fragment rendered="#{issue.status == 'SUGGESTED'}">
							<a class="btn btn-sm btn-default" onclick="want('#{issue.id}');" title="Want Suggestion">
								<i class="fa fa-heart"></i>
							</a>
						</ui:fragment>
						<ui:fragment rendered="#{issue.status != 'SUGGESTED'}">
							<a class="btn btn-sm btn-danger" onclick="if (confirm('Are you sure you want to delete #{movies.fixName(issue.name)} ?')) { deleteDownloadable('#{issue.id}'); };" title="Delete Issue">
								<i class="fa fa-trash-o"></i>
							</a>
						</ui:fragment>
						<h:commandLink styleClass="btn btn-sm btn-default" onclick="return (confirm('Are you sure you want to redownload #{movies.fixName(issue.name)} ?'));" rendered="#{issue.status == 'SNATCHED' or issue.status == 'DOWNLOADED'}">
							<f:ajax execute="@this" render="@none" listener="#{kiosk.redownload(issue.id)}" />
							<i class="fa fa-refresh"></i>
						</h:commandLink>
						<ui:fragment rendered="#{issue.status == 'DOWNLOADED'}">
							<a href="#" class="btn btn-sm btn-default" data-toggle="modal" data-target="#fileList" data-downloadable="${issue.id}" title="Show magazine files">
								<i class="fa fa-list"></i>
							</a>
						</ui:fragment>
					</div>
				</div>
			</ui:repeat>

			<ui:include src="/components/pager.xhtml" />

		</h:form>

	</ui:define>

	<ui:define name="custom_js">
		<script>
		function want(id) {
			$.ajax({
				  url: "want",
				  data: {
				    id: id
				  },
				  beforeSend: function() {
					  disappear( 'bounceOutUp', $('#' + id) );
				  }
			});
		}
		function deleteDownloadable(id) {
			$.ajax({
				  url: "delete",
				  data: {
				    id: id
				  },
				  beforeSend: function() {
					  disappear( 'bounceOutUp', $('#' + id) );
				  }
			});
		}		
		</script>
	</ui:define>
</ui:composition>

</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core">

<ui:composition template="/template.xhtml">

	<ui:define name="content">
	
		<ui:include src="/fragment-filesDialog.xhtml" />
		<ui:include src="/fragment-suggestionsDialog.xhtml" />
		<ui:include src="/fragment-searchResultsDialog.xhtml" />

		<style>
			.downloadableThumb {
				border: none;
				height: 350px;
			}
			
			.downloadableThumb img {
				min-height: 330px;
				max-height: 330px;
			}
			
			.thumbnail .caption {
				font-weight: bold;
				white-space: nowrap;
				text-align: center;
				overflow: scroll;
				max-width: 270px;
			}

			.buttons {
				position: absolute; right: 32px; top: 10px;
			}
		</style>
		
		<h:form styleClass="form-inline">
			<div class="form-group">
				<h:outputLabel value="Language" for="language" styleClass="control-label" />
				<h:selectOneMenu id="language" styleClass="form-control" value="#{kiosk.language}">
					<f:selectItem itemValue="" itemLabel="All" />
					<f:selectItems value="#{listOfValues.languages}" />
					<f:ajax render="listForm" execute="@form" listener="#{kiosk.changeFilter}" />
				</h:selectOneMenu>
			</div>
			<div class="form-group">
				<h:outputLabel value="Name" styleClass="control-label" />
				<h:inputText value="#{kiosk.filter}" styleClass="form-control">
					<f:ajax render="listForm" execute="@form" listener="#{kiosk.changeFilter}" />
				</h:inputText>
			</div>
			<div class="checkbox">
				<label><h:selectBooleanCheckbox value="#{kiosk.includeAdult}" /> Include Adult Results </label>
			</div>
		</h:form>
		
		<h:form id="listForm">
			<ui:include src="/components/pager.xhtml" />

			<ui:repeat var="downloadable" value="#{pager.items}">
				<div id="#{downloadable.id}" class="col-lg-2 col-md-2 col-sm-3 col-xs-6">
					<div class="thumbnail downloadableThumb">
						<ui:fragment rendered="#{downloadable.status == 'DOWNLOADED'}">
							<a href="/download?id=#{downloadable.id}" target="_blank">
								<img data-src="#{downloadable.urlEncodedCoverImage}" alt="#{downloadable.name}" title="#{downloadable.name}" />
							</a>
						</ui:fragment>
						<ui:fragment rendered="#{downloadable.status != 'DOWNLOADED'}">					
							<img data-src="#{downloadable.urlEncodedCoverImage}" alt="#{downloadable.name}" title="#{downloadable.name}" />
						</ui:fragment>
						<div class="caption">#{downloadable.name}</div>
					</div>
					<div class="buttons">
						<ui:fragment rendered="#{downloadable.status != 'SUGGESTED'}">
							<a class="btn btn-sm btn-danger" onclick="if (confirm('Are you sure you want to delete #{downloadableManagedBean.fixName(downloadable.name)} ?')) { deleteDownloadable('#{downloadable.id}'); };" title="Delete Issue">
								<i class="fa fa-trash-o"></i>
							</a>
						</ui:fragment>
						<ui:fragment rendered="#{downloadable.status == 'SUGGESTED'}">
							<a class="btn btn-sm btn-default" onclick="want('#{downloadable.id}');" title="Want Suggestion">
								<i class="fa fa-heart"></i>
							</a>
						</ui:fragment>
						<h:commandLink styleClass="btn btn-sm btn-default" onclick="return (confirm('Are you sure you want to redownload #{downloadableManagedBean.fixName(downloadable.name)} ?'));" rendered="#{downloadable.status == 'SNATCHED' or downloadable.status == 'DOWNLOADED'}">
							<f:ajax execute="@this" render="@none" listener="#{downloadableManagedBean.redownload(downloadable.id)}" />
							<i class="fa fa-refresh"></i>
						</h:commandLink>
						<ui:fragment rendered="#{downloadable.status == 'DOWNLOADED'}">
							<a href="#" class="btn btn-sm btn-default" data-toggle="modal" data-target="#fileList" data-downloadable="${downloadable.id}" title="Show files">
								<i class="fa fa-list"></i>
							</a>
						</ui:fragment>
						<a href="#" class="btn btn-sm btn-default" data-toggle="modal" data-target="#suggestionsList" data-downloadable="${downloadable.id}" title="Show suggestion sources">
							<i class="fa fa-question"></i>
						</a>
						<a href="#" class="btn btn-sm btn-default" data-toggle="modal" data-target="#searchResultsList" data-downloadable="${downloadable.id}" title="Show search results">
							<i class="fa fa-search"></i>
						</a>
					</div>
				</div>
			</ui:repeat>

			<ui:include src="/components/pager.xhtml" />

		</h:form>

	</ui:define>

	<ui:define name="custom_js">
		<script>
		function want(id) {
			$.ajax({
				  url: "want",
				  data: {
				    id: id
				  },
				  beforeSend: function() {
					  disappear( 'bounceOutUp', $('#' + id) );
				  }
			});
		}
		function deleteDownloadable(id) {
			$.ajax({
				  url: "delete",
				  data: {
				    id: id
				  },
				  beforeSend: function() {
					  disappear( 'bounceOutUp', $('#' + id) );
				  }
			});
		}		
		</script>
	</ui:define>
</ui:composition>

</html>
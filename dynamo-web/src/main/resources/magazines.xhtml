<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core">

<ui:composition template="/template.xhtml">

	<ui:define name="content">
	
		<ui:include src="/fragment-filesDialog.xhtml" />

		<style>
			.magazineThumb {
				border: none;
			}
			
			.magazineCover {
				min-height: 240px;
				max-height: 240px;
			}
			
			.magazineCaption {
				font-size: 12px;
				font-weight: bold;
				white-space: nowrap;
				overflow: hidden;
			}

			.buttons {
				position: absolute; right: 32px; top: 10px; width: 20px;
			}
		</style>

		<h:form styleClass="form-inline">
			<ui:include src="magazines-criteria.xhtml" />
			
			<ui:include src="/components/pager.xhtml" />

			<ui:repeat var="issue" value="#{pager.items}">
				<div id="#{issue.id}" class="magazine col-lg-2 col-md-2 col-sm-3 col-xs-6">
					<div class="thumbnail magazineThumb">
						<ui:fragment rendered="#{issue.status == 'DOWNLOADED'}">					
							<a href="/download?id=#{issue.id}" target="_blank">
								<img class="magazineCover" data-src="#{issue.urlEncodedCoverImage}" alt="#{issue.rawName}" title="#{issue.rawName}" />
							</a>
						</ui:fragment>
						<ui:fragment rendered="#{issue.status != 'DOWNLOADED'}">					
							<img class="magazineCover" data-src="#{issue.urlEncodedCoverImage}" alt="#{issue.rawName}" title="#{issue.rawName}" />
						</ui:fragment>
						<div class="caption magazineCaption">#{issue.rawName}</div>
					</div>
					<div class="buttons">
						<ui:fragment rendered="#{issue.status == 'SUGGESTED'}">
							<a href="#" class="btn btn-sm btn-default" onclick="want('#{issue.id}');" title="Want Suggestion">
								<i class="fa fa-heart"></i>
							</a>
						</ui:fragment>
						<ui:fragment rendered="#{issue.status != 'SUGGESTED'}">
							<a class="btn btn-sm btn-danger" onclick="if (confirm('Are you sure you want to delete #{movies.fixName(issue.rawName)} ?')) { delete('#{issue.id}'); };" title="Delete Issue">
								<i class="fa fa-trash-o"></i>
							</a>
						</ui:fragment>
						<h:commandLink styleClass="btn btn-sm btn-default" onclick="return (confirm('Are you sure you want to redownload #{movies.fixName(issue.rawName)} ?'));" rendered="#{issue.status == 'SNATCHED' or issue.status == 'DOWNLOADED'}">
							<f:ajax execute="@this" render="@none" listener="#{kiosk.redownload(issue.id)}" />
							<i class="fa fa-refresh"></i>
						</h:commandLink>
						<h:commandLink styleClass="btn btn-sm btn-default" action="#{fileList.search}" title="Show Files" rendered="#{issue.status == 'DOWNLOADED'}">
							<f:setPropertyActionListener value="#{issue.id}" target="#{fileList.downloadableId}" />
							<f:ajax onevent="showFiles" render=":showFilesForm" />
							<i class="fa fa-list"></i>
						</h:commandLink>
						
					</div>
				</div>
			</ui:repeat>

			<ui:include src="/components/pager.xhtml" />

		</h:form>

	</ui:define>

	<ui:define name="custom_js">
		<script>
		function removeIssueFromKiosk( data ) {
			if (data.status == 'begin') {
				disappear( 'bounceOutUp', $(data.source).closest('div.magazine') );
			}
		}
		function want(id) {
			$.ajax({
				  url: "want",
				  data: {
				    id: id
				  },
				  beforeSend: function() {
					  disappear( 'bounceOutUp', $('#' + id) );
				  }
			});
		}
		function remove(id) {
			$.ajax({
				  url: "delete",
				  data: {
				    id: id
				  },
				  beforeSend: function() {
					  disappear( 'bounceOutUp', $('#' + id) );
				  }
			});
		}		
		</script>
	</ui:define>
</ui:composition>

</html>
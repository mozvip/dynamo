<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough">

<ui:composition template="/template.xhtml">

	<ui:define name="title">
		#{musicArtist.name}
    </ui:define>

	<ui:define name="content">

		<f:metadata>
			<f:viewParam name="name" value="#{musicArtist.name}" />
			<f:event type="preRenderView" listener="#{musicArtist.init}" />
		</f:metadata>

		<div class="row">
			<div class="col-md-8">
				<h:panelGroup rendered="#{musicArtist.artist.allMusicURL != null}">
					<a href="#{musicArtist.artist.allMusicURL}" target="_blank" style="text-decoration: none; color: white;">
						<h1><i class="fa fa-external-link" />&nbsp;#{musicArtist.name}</h1>
					</a>				
				</h:panelGroup>
				<h:panelGroup rendered="#{musicArtist.artist.allMusicURL == null}">
					<h1>#{musicArtist.name}</h1>
				</h:panelGroup>
			</div>
			<div class="col-md-4">
				<h:form>
					<div id="top-buttons" class="btn-group" style="margin-top: 20px">
						<h:commandLink styleClass="btn btn-default" action="#{musicArtist.toggleFavorite}">
							<f:ajax render="@this" />
							<i class="fa fa-heart" />&nbsp;<h:outputText value="#{musicArtist.artist.favorite?'Unfavorite':'Favorite'}" />
						</h:commandLink>
						<h:commandLink styleClass="btn btn-default" action="#{musicArtist.refresh}">
							<f:ajax execute="@this" />
							<i class="fa fa-refresh" />&nbsp;Refresh
						</h:commandLink>					
						<h:commandLink styleClass="btn btn-default" action="#{musicArtist.rescan}">
							<f:ajax execute="@this" />
							<i class="fa fa-refresh" />&nbsp;Rescan
						</h:commandLink>					
						<h:commandLink styleClass="btn btn-danger" action="#{musicArtist.delete}" onclick="return confirm('Are you sure you want to delete this artist will all associated albums and files ?');">
							<i class="fa fa-trash-o" />
						</h:commandLink>					
					</div>
				</h:form>
			</div>
		</div>

		<div id="manualAlbumSearch" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h3>Set New Album Name</h3>
					</div>
					<div class="modal-body">
						<h:form>
							<div class="input-group">
								<h:inputText value="#{musicArtist.albumSearch}" styleClass="form-control" required="true" />
								<span class="input-group-btn">
									<h:commandLink styleClass="btn btn-primary" action="#{musicArtist.changeAlbum}">
										<f:ajax execute="@form" render="@all" onevent="closeAlbumDialogOnSuccess"></f:ajax>
										<i class="fa fa-apply" />&nbsp;Set Album
									</h:commandLink>
								</span>
							</div>
						</h:form>
					</div>
				</div>
			</div>
		</div>
		
		<div id="manualArtistSearch" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h3>Manual Artist Search</h3>
					</div>
					<div class="modal-body">
						<h:form>
							<div class="input-group">
								<h:inputText value="#{musicArtist.artistSearch}" styleClass="form-control artist" />
								<span class="input-group-btn">
									<h:commandLink styleClass="btn btn-primary" action="#{musicArtist.changeArtist}">
										<f:ajax execute="@form" render="@all" onevent="closeArtistDialogOnSuccess"></f:ajax>
										<i class="fa fa-apply" />&nbsp;Set Artist
									</h:commandLink>
								</span>
							</div>
						</h:form>
					</div>
				</div>
			</div>
		</div>		

		<ui:repeat value="#{musicArtist.albums}" id="albumsTable" var="album">
				<a id="#{album.id}"/>
				<h:form>
					<h:inputHidden styleClass="selectedAlbumId" value="#{musicArtist.selectedAlbumId}" />
					<div class="row">
						<div class="col-lg-2">
							<h:commandLink action="#{musicArtist.findNewImage(album)}">
								<h:graphicImage value="#{album.coverImage}" width="125" height="125" styleClass="img-thumbnail" />
								<f:ajax />
							</h:commandLink>
						</div>
						<div class="col-lg-10">
							<h:panelGroup rendered="#{album.allMusicURL != null}">
								<a href="#{album.allMusicURL}" target="_blank">
									<h3>#{album.album}</h3>
								</a>
							</h:panelGroup>
							<h:panelGroup rendered="#{album.allMusicURL == null}">
								<h3>
									<h:panelGroup rendered="#{musicArtist.artist.allMusicURL != null}">
										#{album.album}
										<h:commandLink p:data-toggle="modal" p:data-target="#manualAlbumSearch" action="#{musicArtist.setSelectedAlbumId(album.id)}">
											<f:ajax onevent="openAlbumDialog" execute="@form" render="@form" />
											<i class="fa fa-search" />
										</h:commandLink>											
									</h:panelGroup>
									<h:panelGroup rendered="#{musicArtist.artist.allMusicURL == null}">
										#{album.album}
									</h:panelGroup>
									<div>
										<ui:fragment rendered="#{album.status == 'IGNORED'}">
											<h:commandLink styleClass="btn btn-default" action="#{musicArtist.want(album)}">
												<i class="fa fa-plus" />&nbsp;Download this album
												<f:ajax render="@form" />
											</h:commandLink>
										</ui:fragment>
										<ui:fragment rendered="#{album.downloaded}">
											<div class="btn-group">
												<div class="dropdown">
													<a type="button" class="btn btn-default dropdown-toggle" id="dropdownMenuAlbum" data-toggle="dropdown">Album<span class="caret"></span>
													</a>
													<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuAlbum">
														<li>
															<h:commandLink action="#{musicArtist.redownload(album.id)}" onclick="return( confirm('Are you sure you want to redownload this album ? Existing files will be deleted.') );">
																<f:ajax render="@all" />
																Redownload Album
															</h:commandLink>
														</li>													
														<li>
															<h:commandLink action="#{musicArtist.setAlbumArtist(album.id, 'Various Artists')}">
																<f:ajax render="@all" />
																Set Album Artist to 'Various Artists'
															</h:commandLink>
														</li>
														<li>
															<h:commandLink action="#{musicArtist.setAlbumArtist(album.id, 'Original Soundtrack')}">
																<f:ajax render="@all" />
																Set Album Artist to 'Original Soundtrack'
															</h:commandLink>
														</li>
														<li>
															<h:commandLink action="#{musicArtist.setAlbumArtist(album.id, 'Mash-Up')}">
																<f:ajax render="@all" />
																Set Album Artist to 'Mash-Up'
															</h:commandLink>
														</li>
														<li>
															<h:commandLink action="#{musicArtist.setAlbumArtist(album.id, 'Top Singles')}">
																<f:ajax render="@all" />
																Set Album Artist to 'Top Singles'
															</h:commandLink>
														</li>
														<li>
															<h:commandLink action="#{musicArtist.setAlbumArtist(album.id, 'Video Game Soundtrack')}">
																<f:ajax render="@all" />
																Set Album Artist to 'Video Game Soundtrack'
															</h:commandLink>
														</li>													
													</ul>
												</div>
												<div class="dropdown">
												  <a class="btn btn-default btn-small dropdown-toggle" id="dropdownMenuSelection" data-toggle="dropdown" href="#">Selection<span class="caret"></span>
												  </a>
												  <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSelection">
													<li>
														<h:commandLink value="Set Artist" p:data-toggle="modal" p:data-target="#manualArtistSearch" action="#{musicArtist.setSelectedAlbumId(album.id)}">
															<f:ajax onevent="openArtistDialog" execute="@form" render="@form" />
														</h:commandLink>
													</li>
													<li>
														<h:commandLink value="Set Album" p:data-toggle="modal" p:data-target="#manualAlbumSearch" action="#{musicArtist.setSelectedAlbumId(album.id)}">
															<f:ajax onevent="openAlbumDialog" execute="@form" render="@form" />
														</h:commandLink>
													</li>
													<li><h:commandLink action="#{musicArtist.deleteFiles(album.id)}" onclick="return confirm('Are you sure you want to delete these files ?');">&nbsp;Delete Files<f:ajax execute="@form" render="@form" /></h:commandLink></li>
													<li><h:commandLink action="#{musicArtist.identifyFiles(album.id)}">&nbsp;Identify Files<f:ajax execute="@form" render="@form" /></h:commandLink></li>
												  </ul>
												 </div>
											</div>
										</ui:fragment>
									</div>
								</h3>
							</h:panelGroup>
							<ui:fragment rendered="#{album.downloaded}">
								<p style="font-family: courier">#{album.path}</p>
							</ui:fragment>
							<ui:fragment rendered="#{!album.downloaded}">
								
							</ui:fragment>
						</div>
					</div>

					<h:dataTable styleClass="table table-condensed table-hover" rowClasses="#{musicArtist.rowClasses[album]}" id="filesTable" value="#{musicArtist.getFiles(album.id)}" var="musicFile" rendered="#{album.downloaded}">
						<h:column>
							<h:commandLink styleClass="btn btn-sm btn-danger" onclick="if (confirm('Are you sure you want to delete this file ?')) { $(this).closest('tr').remove(); return true; } else { return false; }">
								<f:ajax execute="@this" render="@none" listener="#{musicArtist.deleteFile(album.id, musicFile)}" />
								<i class="fa fa-trash-o" />
							</h:commandLink>
							<h:commandLink styleClass="btn btn-sm btn-default" action="#{musicArtist.identifyFile(album.id, musicFile)}">
								<f:ajax execute="@this" render="@none" />
								<i class="fa fa-question" />
							</h:commandLink>
						</h:column>
						<h:column>
							<f:facet name="header">
								<a href="#" class="btn btn-sm btn-default checkBoxSelectionButton">
									<i class="fa fa-check-square-o" />
								</a>
							</f:facet>
							<h:selectBooleanCheckbox value="#{musicArtist.selection[musicFile]}" />
						</h:column>
						<h:column>
							<f:facet name="header">
								#
							</f:facet>
							<h:outputText value="#{musicFile.track}"></h:outputText>
						</h:column>
						<h:column>
							<f:facet name="header">
								<h:outputText value="Song Artist" styleClass="hidden-xs" />
							</f:facet>
							<h:outputText value="#{musicFile.songArtist}" styleClass="hidden-xs" />
						</h:column>
						<h:column>
							<f:facet name="header">
								Song Title
							</f:facet>
							<h:outputText value="#{musicFile.songTitle}" styleClass="tooltipped" p:data-toggle="tooltip" title="#{musicFile.path}" />
						</h:column>
						<h:column>
							<h:outputText value="#{musicFile.size}">
								<f:converter converterId="FileSizeConverter" />
							</h:outputText>
						</h:column>
					</h:dataTable>
				</h:form>
		</ui:repeat>
	</ui:define>
	
	<ui:define name="custom_js">
		<script>

			function openArtistDialog(e) {
				if (e.status == 'success') {
					$('#manualArtistSearch').modal();
				}
			}
		
			function openAlbumDialog(e) {
				if (e.status == 'success') {
					$('#manualAlbumSearch').modal();
				}
			}
			
			function closeAlbumDialogOnSuccess(e) {
				if (e.status == 'success') {
					$('#manualAlbumSearch').modal('hide');
				}
			}
			
			function closeArtistDialogOnSuccess(e) {
				if (e.status == 'success') {
					$('#manualArtistSearch').modal('hide');
				}
			}

			$('.tooltipped').tooltip();	
			$('.artist').typeahead({
				  name: 'artists',
				  remote: '#{request.contextPath}/suggest-music-artist/?q=%QUERY'
			});
		</script>
	</ui:define>	

</ui:composition>

</html>
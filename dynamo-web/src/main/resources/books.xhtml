<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core">

<ui:composition template="/template.xhtml">

	<ui:define name="content">
	
		<ui:include src="/fragment-filesDialog.xhtml" />
		<ui:include src="/fragment-suggestionsDialog.xhtml" />
		<ui:include src="/fragment-searchResultsDialog.xhtml" />

		<style>
			.downloadableThumb {
				border: none;
				height: 350px;
			}
			
			.downloadableThumb img {
				min-height: 330px;
				max-height: 330px;
			}
			
			.thumbnail .caption {
				font-weight: bold;
				white-space: nowrap;
				text-align: center;
				overflow: scroll;
				max-width: 270px;
			}

			.buttons {
				position: absolute; right: 32px; top: 10px;
			}
		</style>


		<h:form styleClass="form-inline">
			<div class="col-lg-12 col-md-12 col-sm12 col-xs12">
				<div class="form-group">
					<h:outputLabel value="Language" styleClass="control-label" />
					<h:selectOneMenu styleClass="form-control"
						value="#{bookKiosk.language}">
						<f:selectItem itemValue="" itemLabel="All" />
						<f:selectItems value="#{listOfValues.languages}" />
						<f:ajax render="@form" execute="@form"
							listener="#{bookKiosk.changeFilter}" />
					</h:selectOneMenu>
				</div>
				<div class="form-group">
					<h:outputLabel value="Name" styleClass="control-label" />
					<h:inputText value="#{bookKiosk.filter}" styleClass="form-control">
						<f:ajax render="@form" execute="@form"
							listener="#{bookKiosk.changeFilter}" />
					</h:inputText>
				</div>
			</div>
			
			<ui:include src="/components/pager.xhtml" />

			<ui:repeat var="downloadable" value="#{pager.items}">
				<div id="#{downloadable.id}" class="col-lg-2 col-md-2 col-sm-3 col-xs-6">
					<div class="thumbnail downloadableThumb">
						<ui:fragment rendered="#{downloadable.status == 'DOWNLOADED'}">
							<a href="/download?id=#{downloadable.id}" target="_blank">
								<img data-src="#{downloadable.urlEncodedCoverImage}" alt="#{downloadable.name}" title="#{downloadable.name}" />
							</a>
						</ui:fragment>
						<ui:fragment rendered="#{downloadable.status == 'SUGGESTED'}">
							<a href="#" onclick="want('#{downloadable.id}');">
								<img data-src="#{downloadable.urlEncodedCoverImage}" alt="#{downloadable.name}" title="#{downloadable.name}" />
							</a>
						</ui:fragment>
						<ui:fragment rendered="#{downloadable.status != 'SUGGESTED' and downloadable.status != 'DOWNLOADED'}">
							<img data-src="#{downloadable.urlEncodedCoverImage}" alt="#{downloadable.name}" title="#{downloadable.name}" />
						</ui:fragment>
						<div class="caption">#{downloadable.name}</div>
					</div>
					<div class="buttons">
						<h:commandLink styleClass="btn btn-sm btn-danger" onclick="return (confirm('Are you sure you want to delete #{movies.fixName(downloadable.name)} ?'));" rendered="#{downloadable.status != 'SUGGESTED'}">
							<f:ajax execute="@this" render="@none" listener="#{bookKiosk.delete}" onevent="removeIssueFromKiosk"/>
							<f:param name="id" value="#{downloadable.id}" />
							<i class="fa fa-trash-o"></i>
						</h:commandLink>
						<h:commandLink styleClass="btn btn-sm btn-default" onclick="return (confirm('Are you sure you want to redownload #{movies.fixName(downloadable.name)} ?'));" rendered="#{downloadable.status == 'SNATCHED' or downloadable.status == 'DOWNLOADED'}">
							<f:ajax execute="@this" render="@none" listener="#{bookKiosk.redownload(downloadable.id)}" />
							<i class="fa fa-refresh"></i>
						</h:commandLink>
						<ui:fragment rendered="#{downloadable.status == 'DOWNLOADED'}">
							<a href="#" class="btn btn-sm btn-default" data-toggle="modal" data-target="#fileList" data-downloadable="${downloadable.id}" title="Show files">
								<i class="fa fa-list"></i>
							</a>
						</ui:fragment>						
						<a href="#" class="btn btn-sm btn-default" data-toggle="modal" data-target="#suggestionsList" data-downloadable="${downloadable.id}" title="Show suggestion sources">
							<i class="fa fa-question"></i>
						</a>
						<a href="#" class="btn btn-sm btn-default" data-toggle="modal" data-target="#searchResultsList" data-downloadable="${downloadable.id}" title="Show search results">
							<i class="fa fa-search"></i>
						</a>
					</div>
				</div>
			</ui:repeat>

			<ui:include src="/components/pager.xhtml" />
		</h:form>

	</ui:define>
	<ui:define name="custom_js">
		<script>
		function want(id) {
			$.ajax({
				  url: "want",
				  data: {
				    id: id
				  },
				  beforeSend: function() {
					  disappear( 'bounceOutUp', $('#' + id) );
				  }
				});
		}
		function removeIssueFromKiosk( data ) {
			if (data.status == 'begin') {
				disappear( 'bounceOutUp', $(data.source).closest('div.book') );
			}
		}
		</script>
	</ui:define>
</ui:composition>

</html>